<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#e7ddc8" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#181c27" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="null//null" crossorigin><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/./images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/./images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/./images/favicon-16x16-next.png"><link rel="mask-icon" href="/./images/safari-pinned-tab-next.svg" color="#e7ddc8"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=LXGW:300,300italic,400,400italic,700,700italic%7CNoto+Serif+SC:300,300italic,400,400italic,700,700italic%7CLong+Cang:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.xianlongok.site","root":"/","images":"/blog/images/","scheme":"Gemini","darkmode":true,"version":"8.11.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":null,"post_body":null,"coll_header":null,"sidebar":"fadeInDown"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="最近开发过程中，碰到一个比较奇怪的Bug，同事在场景中创建了个3D UI，使用的是WidgetComponent组件，然后动态设置widget实例，第一次创建的3D UI可以正常接收到鼠标事件，通过3D UI进入战斗场景后，第二场战斗的3D UI界面没法相应事件了，然后我就接住这口锅了。  wbp_path &#x3D; &#39;&#x2F;Game&#x2F;test_3d_ui.test_3d_ui&#39; # game.ui: 全局"><meta property="og:type" content="article"><meta property="og:title" content="UE4 SlateUI事件机制"><meta property="og:url" content="https://www.xianlongok.site/post/360e070e/index.html"><meta property="og:site_name" content="十三"><meta property="og:description" content="最近开发过程中，碰到一个比较奇怪的Bug，同事在场景中创建了个3D UI，使用的是WidgetComponent组件，然后动态设置widget实例，第一次创建的3D UI可以正常接收到鼠标事件，通过3D UI进入战斗场景后，第二场战斗的3D UI界面没法相应事件了，然后我就接住这口锅了。  wbp_path &#x3D; &#39;&#x2F;Game&#x2F;test_3d_ui.test_3d_ui&#39; # game.ui: 全局"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.xianlongok.site/images/ue4_event/button_event_statck.png"><meta property="og:image" content="https://www.xianlongok.site/images/ue4_event/update_hittest_area.png"><meta property="article:published_time" content="2021-04-29T06:50:36.000Z"><meta property="article:modified_time" content="2022-05-14T03:20:32.415Z"><meta property="article:author" content="小贤"><meta property="article:tag" content="C++"><meta property="article:tag" content="UE4"><meta property="article:tag" content="UMG"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.xianlongok.site/images/ue4_event/button_event_statck.png"><link rel="canonical" href="https://www.xianlongok.site/post/360e070e/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.xianlongok.site/post/360e070e/","path":"post/360e070e/","title":"UE4 SlateUI事件机制"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>UE4 SlateUI事件机制 | 十三</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-228435313-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-228435313-1","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><link rel="dns-prefetch" href="https://waline-comment-nfec4vcyk-qq317423892.vercel.app/"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">十三</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">安心学技术</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fas fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-splotch fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fas fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-tools"><a href="/tools/" rel="section"><i class="fas fa-wrench fa-fw"></i>工具</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fas fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="fas fa-book fa-fw"></i>留言板</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E6%9D%A5%E6%BA%90"><span class="nav-number">1.</span> <span class="nav-text">事件来源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%93%8D%E5%BA%94%E6%8E%A7%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">获取响应控件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#todo"><span class="nav-number">3.</span> <span class="nav-text">TODO:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E4%BA%8B%E4%BB%B6"><span class="nav-number">4.</span> <span class="nav-text">响应事件</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="小贤" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">小贤</p><div class="site-description" itemprop="description">Watch and learn, your magic is mine!</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/qq317423892" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qq317423892" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a> </span><span class="links-of-author-item"><a href="mailto:xianlongok@163.com" title="E-Mail → mailto:xianlongok@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a></span></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://scorpioq.github.io/" title="https:&#x2F;&#x2F;scorpioq.github.io&#x2F;" rel="noopener" target="_blank">ScorpioQ</a></li><li class="links-of-blogroll-item"><a href="https://www.xygblog.com/" title="https:&#x2F;&#x2F;www.xygblog.com&#x2F;" rel="noopener" target="_blank">邪妖怪のBlog</a></li></ul></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.xianlongok.site/post/360e070e/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="小贤"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="十三"><meta itemprop="description" content="Watch and learn, your magic is mine!"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="UE4 SlateUI事件机制 | 十三"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">UE4 SlateUI事件机制</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-04-29 14:50:36" itemprop="dateCreated datePublished" datetime="2021-04-29T14:50:36+08:00">2021-04-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/UE4/" itemprop="url" rel="index"><span itemprop="name">UE4</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/UE4/SlateUI/" itemprop="url" rel="index"><span itemprop="name">SlateUI</span></a> </span></span><span id="/post/360e070e/" class="post-meta-item leancloud_visitors" data-flag-title="UE4 SlateUI事件机制" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Waline：</span> <a title="waline" href="/post/360e070e/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/post/360e070e/" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>20k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>18 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>最近开发过程中，碰到一个比较奇怪的Bug，同事在场景中创建了个3D UI，使用的是WidgetComponent组件，然后动态设置widget实例，第一次创建的3D UI可以正常接收到鼠标事件，通过3D UI进入战斗场景后，第二场战斗的3D UI界面没法相应事件了，然后我就接住这口锅了。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">wbp_path <span class="token operator">=</span> <span class="token string">'/Game/test_3d_ui.test_3d_ui'</span>
<span class="token comment"># game.ui: 全局ui管理器</span>
<span class="token comment"># create_3d_ui:加载WidgetBlueprint，并打开</span>
widget <span class="token operator">=</span> game<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>create_3d_ui<span class="token punctuation">(</span>wbp_path<span class="token punctuation">)</span>
widget_comp<span class="token punctuation">.</span>set_widget<span class="token punctuation">(</span>widget<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">PyObject <span class="token operator">*</span><span class="token function">py_ue_set_widget</span><span class="token punctuation">(</span>ue_PyUObject <span class="token operator">*</span> self<span class="token punctuation">,</span> PyObject <span class="token operator">*</span> args<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">ue_py_check</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>

    PyObject <span class="token operator">*</span>widget<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">PyArg_ParseTuple</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token string">"O"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>widget<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    
    UWidgetComponent <span class="token operator">*</span>widget_component <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ue_py_check_type</span><span class="token generic class-name"><span class="token operator">&lt;</span>UWidgetComponent<span class="token operator">></span></span></span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>widget_component<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">PyErr_Format</span><span class="token punctuation">(</span>PyExc_Exception<span class="token punctuation">,</span> <span class="token string">"uobject is not a UWidgetComponent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    UUserWidget <span class="token operator">*</span>uwidget <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ue_py_check_type</span><span class="token generic class-name"><span class="token operator">&lt;</span>UUserWidget<span class="token operator">></span></span></span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>uwidget<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">PyErr_Format</span><span class="token punctuation">(</span>PyExc_Exception<span class="token punctuation">,</span> <span class="token string">"argument2 is not a APlayerController"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    widget_component<span class="token operator">-></span><span class="token function">SetWidget</span><span class="token punctuation">(</span>uwidget<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Py_RETURN_NONE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后开始看UE4源码，研究下UE4 SlateUI事件机制 ## 按钮事件调用栈 下图是从Launch.cpp里里的GEngineLoop Tick调用Windows平台处理事件的代码，最终进入Button代码，响应OnClicked回调的调用栈。 <img data-src="/images/ue4_event/button_event_statck.png" width="100%" height="100%" align="middle"></p><h2 id="事件来源">事件来源</h2><p>在Windows平台上，鼠标点击，键盘事件都是调用Windows的API，从Windows事件列表中获取的。<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** 
 * Ticks the engine loop 
 * Engine\Source\Runtime\Launch\Private\Launch.cpp
 */</span>
<span class="token keyword">void</span> <span class="token function">EngineTick</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">//** line:62 **//</span>
    GEngineLoop<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Engine\Source\Runtime\ApplicationCore\Private\Windows\WindowsPlatformApplicationMisc.cpp
 * windows 消息处理
 */</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">WinPumpMessages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#123;</span>
        MSG Msg<span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">PeekMessage</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Msg<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>PM_REMOVE<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">TranslateMessage</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>Msg <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//* line:108 *//</span>
            <span class="token function">DispatchMessage</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>Msg <span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Engine\Source\Runtime\ApplicationCore\Private\Windows\WindowsApplication.cpp
 */</span>
int32 <span class="token class-name">FWindowsApplication</span><span class="token double-colon punctuation">::</span><span class="token function">ProcessMessage</span><span class="token punctuation">(</span> HWND hwnd<span class="token punctuation">,</span> uint32 msg<span class="token punctuation">,</span> WPARAM wParam<span class="token punctuation">,</span> LPARAM lParam <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TSharedPtr<span class="token operator">&lt;</span> FWindowsWindow <span class="token operator">></span> CurrentNativeEventWindowPtr <span class="token operator">=</span> <span class="token function">FindWindowByHWND</span><span class="token punctuation">(</span> Windows<span class="token punctuation">,</span> hwnd <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span> Windows<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> CurrentNativeEventWindowPtr<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">// .....</span>

        <span class="token keyword">switch</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> WM_KEYDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_SYSKEYUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_KEYUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_LBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_LBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_RBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_RBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_XBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_XBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_XBUTTONUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_LBUTTONUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MBUTTONUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_RBUTTONUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_NCMOUSEMOVE<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MOUSEMOVE<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MOUSEWHEEL<span class="token operator">:</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">WINVER <span class="token operator">>=</span> <span class="token number">0x0601</span></span></span>
            <span class="token keyword">case</span> WM_TOUCH<span class="token operator">:</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
                <span class="token punctuation">&#123;</span>
                    <span class="token comment">//** line:1042 **//</span>
                    <span class="token function">DeferMessage</span><span class="token punctuation">(</span> CurrentNativeEventWindowPtr<span class="token punctuation">,</span> hwnd<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> wParam<span class="token punctuation">,</span> lParam <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Handled</span>
                    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/**
 * Engine\Source\Runtime\ApplicationCore\Private\Windows\WindowsApplication.cpp
 */</span>
int32 <span class="token class-name">FWindowsApplication</span><span class="token double-colon punctuation">::</span><span class="token function">ProcessDeferredMessage</span><span class="token punctuation">(</span> <span class="token keyword">const</span> FDeferredWindowsMessage<span class="token operator">&amp;</span> DeferredMessage <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> Windows<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> DeferredMessage<span class="token punctuation">.</span>NativeWindow<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        HWND hwnd <span class="token operator">=</span> DeferredMessage<span class="token punctuation">.</span>hWND<span class="token punctuation">;</span>
        uint32 msg <span class="token operator">=</span> DeferredMessage<span class="token punctuation">.</span>Message<span class="token punctuation">;</span>
        WPARAM wParam <span class="token operator">=</span> DeferredMessage<span class="token punctuation">.</span>wParam<span class="token punctuation">;</span>
        LPARAM lParam <span class="token operator">=</span> DeferredMessage<span class="token punctuation">.</span>lParam<span class="token punctuation">;</span>

        <span class="token keyword">switch</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> WM_LBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_LBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_RBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_RBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_XBUTTONDBLCLK<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_XBUTTONDOWN<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_LBUTTONUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_MBUTTONUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_RBUTTONUP<span class="token operator">:</span>
            <span class="token keyword">case</span> WM_XBUTTONUP<span class="token operator">:</span>
                <span class="token punctuation">&#123;</span>
                    POINT CursorPoint<span class="token punctuation">;</span>
                    CursorPoint<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token function">GET_X_LPARAM</span><span class="token punctuation">(</span>lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    CursorPoint<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token function">GET_Y_LPARAM</span><span class="token punctuation">(</span>lParam<span class="token punctuation">)</span><span class="token punctuation">;</span> 

                    <span class="token function">ClientToScreen</span><span class="token punctuation">(</span>hwnd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>CursorPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">const</span> FVector2D <span class="token function">CursorPos</span><span class="token punctuation">(</span>CursorPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> CursorPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    EMouseButtons<span class="token double-colon punctuation">::</span>Type MouseButton <span class="token operator">=</span> EMouseButtons<span class="token double-colon punctuation">::</span>Invalid<span class="token punctuation">;</span>
                    <span class="token keyword">bool</span> bDoubleClick <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token keyword">bool</span> bMouseUp <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token keyword">switch</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token keyword">case</span> WM_LBUTTONDBLCLK<span class="token operator">:</span>
                            bDoubleClick <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            MouseButton <span class="token operator">=</span> EMouseButtons<span class="token double-colon punctuation">::</span>Left<span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> WM_LBUTTONUP<span class="token operator">:</span>
                            bMouseUp <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            MouseButton <span class="token operator">=</span> EMouseButtons<span class="token double-colon punctuation">::</span>Left<span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> WM_LBUTTONDOWN<span class="token operator">:</span>
                            MouseButton <span class="token operator">=</span> EMouseButtons<span class="token double-colon punctuation">::</span>Left<span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        
                        <span class="token comment">// ...</span>
                        <span class="token keyword">default</span><span class="token operator">:</span>
                            <span class="token function">check</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>bMouseUp<span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token comment">//** line:2183 **//</span>
                        <span class="token keyword">return</span> MessageHandler<span class="token operator">-></span><span class="token function">OnMouseUp</span><span class="token punctuation">(</span> MouseButton<span class="token punctuation">,</span> CursorPos <span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bDoubleClick<span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        MessageHandler<span class="token operator">-></span><span class="token function">OnMouseDoubleClick</span><span class="token punctuation">(</span> CurrentNativeEventWindowPtr<span class="token punctuation">,</span> MouseButton<span class="token punctuation">,</span> CursorPos <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">&#123;</span>
                        MessageHandler<span class="token operator">-></span><span class="token function">OnMouseDown</span><span class="token punctuation">(</span> CurrentNativeEventWindowPtr<span class="token punctuation">,</span> MouseButton<span class="token punctuation">,</span> CursorPos <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>随后代码进入SlateApplication中，对事件进行封装，然后开始找到响应的Widget，调用对应的响应函数，并最终响应事件。<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">
<span class="token comment">/*  ==================================
    前面都是从Windows事件队列获取消息
    并对消息进行处理，后面开始进入最难
    的地方了
    ==================================
 */</span>

<span class="token comment">/**
 * Engine\Source\Runtime\Slate\Private\Framework\Application\SlateApplication.cpp
 */</span>
<span class="token keyword">bool</span> <span class="token class-name">FSlateApplication</span><span class="token double-colon punctuation">::</span><span class="token function">OnMouseUp</span><span class="token punctuation">(</span> <span class="token keyword">const</span> EMouseButtons<span class="token double-colon punctuation">::</span>Type Button<span class="token punctuation">,</span> <span class="token keyword">const</span> FVector2D CursorPos <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// convert left mouse click to touch event if we are faking it	</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsFakingTouchEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Button <span class="token operator">==</span> EMouseButtons<span class="token double-colon punctuation">::</span>Left<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        bIsFakingTouched <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        
        <span class="token comment">//** line:5305 **//</span>
        <span class="token keyword">return</span> <span class="token function">OnTouchEnded</span><span class="token punctuation">(</span>PlatformApplication<span class="token operator">-></span>Cursor<span class="token operator">-></span><span class="token function">GetPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    FKey Key <span class="token operator">=</span> <span class="token function">TranslateMouseButtonToKey</span><span class="token punctuation">(</span> Button <span class="token punctuation">)</span><span class="token punctuation">;</span>

    FPointerEvent <span class="token function">MouseEvent</span><span class="token punctuation">(</span>
        <span class="token function">GetUserIndexForMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        CursorPointerIndex<span class="token punctuation">,</span>
        CursorPos<span class="token punctuation">,</span>
        <span class="token function">GetLastCursorPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        PressedMouseButtons<span class="token punctuation">,</span>
        Key<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        PlatformApplication<span class="token operator">-></span><span class="token function">GetModifierKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">ProcessMouseButtonUpEvent</span><span class="token punctuation">(</span> MouseEvent <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Engine\Source\Runtime\Slate\Private\Framework\Application\SlateApplication.cpp
 */</span>
<span class="token keyword">bool</span> <span class="token class-name">FSlateApplication</span><span class="token double-colon punctuation">::</span><span class="token function">OnTouchEnded</span><span class="token punctuation">(</span> <span class="token keyword">const</span> FVector2D<span class="token operator">&amp;</span> Location<span class="token punctuation">,</span> int32 TouchIndex<span class="token punctuation">,</span> int32 ControllerId <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TSharedRef<span class="token operator">&lt;</span>FSlateUser<span class="token operator">></span> User <span class="token operator">=</span> <span class="token function">GetOrCreateUser</span><span class="token punctuation">(</span>ControllerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>User<span class="token operator">-></span><span class="token function">IsTouchPointerActive</span><span class="token punctuation">(</span>TouchIndex<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        FPointerEvent <span class="token function">PointerEvent</span><span class="token punctuation">(</span>
            ControllerId<span class="token punctuation">,</span>
            TouchIndex<span class="token punctuation">,</span>
            Location<span class="token punctuation">,</span>
            Location<span class="token punctuation">,</span>
            <span class="token number">0.0f</span><span class="token punctuation">,</span>
            <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//** line:5912 **//</span>
        <span class="token function">ProcessTouchEndedEvent</span><span class="token punctuation">(</span>PointerEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">WITH_SLATE_DEBUGGING</span></span>
        <span class="token function">ensure</span><span class="token punctuation">(</span><span class="token operator">!</span>User<span class="token operator">-></span><span class="token function">IsTouchPointerActive</span><span class="token punctuation">(</span>TouchIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Engine\Source\Runtime\Slate\Private\Framework\Application\SlateApplication.cpp
 */</span>
<span class="token keyword">bool</span> <span class="token class-name">FSlateApplication</span><span class="token double-colon punctuation">::</span><span class="token function">ProcessMouseButtonUpEvent</span><span class="token punctuation">(</span> <span class="token keyword">const</span> FPointerEvent<span class="token operator">&amp;</span> MouseEvent <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// An empty widget path is passed in.  As an optimization, one will be generated only if a captured mouse event isn't routed</span>
    FWidgetPath EmptyPath<span class="token punctuation">;</span>
    <span class="token comment">//** line:5356 **//</span>
    <span class="token keyword">const</span> <span class="token keyword">bool</span> bHandled <span class="token operator">=</span> <span class="token function">RoutePointerUpEvent</span><span class="token punctuation">(</span> EmptyPath<span class="token punctuation">,</span> MouseEvent <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsEventHandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span> bIsCursorUser <span class="token operator">&amp;&amp;</span> PressedMouseButtons<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        PlatformApplication<span class="token operator">-></span><span class="token function">SetCapture</span><span class="token punctuation">(</span> <span class="token keyword">nullptr</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> bHandled<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Engine\Source\Runtime\Slate\Private\Framework\Application\SlateApplication.cpp
 */</span>
FReply <span class="token class-name">FSlateApplication</span><span class="token double-colon punctuation">::</span><span class="token function">RoutePointerUpEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> FWidgetPath<span class="token operator">&amp;</span> WidgetsUnderPointer<span class="token punctuation">,</span> <span class="token keyword">const</span> FPointerEvent<span class="token operator">&amp;</span> PointerEvent<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    TScopeCounter<span class="token operator">&lt;</span>int32<span class="token operator">></span> <span class="token function">BeginInput</span><span class="token punctuation">(</span>ProcessingInput<span class="token punctuation">)</span><span class="token punctuation">;</span>

    FReply Reply <span class="token operator">=</span> <span class="token class-name">FReply</span><span class="token double-colon punctuation">::</span><span class="token function">Unhandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    TSharedRef<span class="token operator">&lt;</span>FSlateUser<span class="token operator">></span> SlateUser <span class="token operator">=</span> <span class="token function">GetOrCreateUser</span><span class="token punctuation">(</span>PointerEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TSharedPtr<span class="token operator">&lt;</span>FDragDropOperation<span class="token operator">></span> LocalDragDropContent<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>SlateUser<span class="token operator">-></span><span class="token function">HasCapture</span><span class="token punctuation">(</span>PointerEvent<span class="token punctuation">.</span><span class="token function">GetPointerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        FWidgetPath MouseCaptorPath <span class="token operator">=</span> SlateUser<span class="token operator">-></span><span class="token function">GetCaptorPath</span><span class="token punctuation">(</span>PointerEvent<span class="token punctuation">.</span><span class="token function">GetPointerIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            FWeakWidgetPath<span class="token double-colon punctuation">::</span>EInterruptedPathHandling<span class="token double-colon punctuation">::</span>Truncate<span class="token punctuation">,</span> <span class="token operator">&amp;</span>PointerEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">ensureMsgf</span><span class="token punctuation">(</span>MouseCaptorPath<span class="token punctuation">.</span>Widgets<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span>"A window had a widget with mouse capture<span class="token punctuation">.</span> 
            That entire window has been dismissed before the mouse up could be processed<span class="token punctuation">.</span>"<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token comment">// Switch worlds widgets in the current path</span>
            FScopedSwitchWorldHack <span class="token function">SwitchWorld</span><span class="token punctuation">(</span> MouseCaptorPath <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//** line:4815 **//</span>
            Reply <span class="token operator">=</span>
                FEventRouter<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Route</span><span class="token generic class-name"><span class="token operator">&lt;</span>FReply<span class="token operator">></span></span></span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">FEventRouter</span><span class="token double-colon punctuation">::</span><span class="token function">FToLeafmostPolicy</span><span class="token punctuation">(</span>MouseCaptorPath<span class="token punctuation">)</span><span class="token punctuation">,</span> PointerEvent<span class="token punctuation">,</span> 
                    <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">(</span> <span class="token keyword">const</span> FArrangedWidget<span class="token operator">&amp;</span> TargetWidget<span class="token punctuation">,</span> <span class="token keyword">const</span> FPointerEvent<span class="token operator">&amp;</span> Event <span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    FReply TempReply <span class="token operator">=</span> <span class="token class-name">FReply</span><span class="token double-colon punctuation">::</span><span class="token function">Unhandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>Event<span class="token punctuation">.</span><span class="token function">IsTouchEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        TempReply <span class="token operator">=</span> TargetWidget<span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">OnTouchEnded</span><span class="token punctuation">(</span>TargetWidget<span class="token punctuation">.</span>Geometry<span class="token punctuation">,</span> Event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Event<span class="token punctuation">.</span><span class="token function">IsTouchEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span>TempReply<span class="token punctuation">.</span><span class="token function">IsEventHandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-></span>bTouchFallbackToMouse<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        TempReply <span class="token operator">=</span> TargetWidget<span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">OnMouseButtonUp</span><span class="token punctuation">(</span> TargetWidget<span class="token punctuation">.</span>Geometry<span class="token punctuation">,</span> Event <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    
                    <span class="token keyword">if</span> <span class="token punctuation">(</span> Event<span class="token punctuation">.</span><span class="token function">IsTouchEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">IsFakingTouchEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token comment">// Generate a Leave event when a touch ends as well, since a </span>
                        <span class="token comment">// touch can enter a widget and then end inside it</span>
                        TargetWidget<span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">OnMouseLeave</span><span class="token punctuation">(</span>Event<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>

                    <span class="token keyword">return</span> TempReply<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> ESlateDebuggingInputEvent<span class="token double-colon punctuation">::</span>MouseButtonUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>LocalWidgetsUnderPointer<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token comment">// 更新屏幕坐标区域中的widget</span>
            LocalWidgetsUnderPointer <span class="token operator">=</span> <span class="token function">LocateWindowUnderMouse</span><span class="token punctuation">(</span>PointerEvent<span class="token punctuation">.</span><span class="token function">GetScreenSpacePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                <span class="token function">GetInteractiveTopLevelWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> SlateUser<span class="token operator">-></span><span class="token function">GetUserIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
* Route an event based on the Routing Policy.
* Engine\Source\Runtime\Slate\Private\Framework\Application\SlateApplication.cpp
*/</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span> <span class="token keyword">typename</span> <span class="token class-name">ReplyType</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">RoutingPolicyType</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">EventType</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">FuncType</span> <span class="token operator">></span>
<span class="token keyword">static</span> ReplyType <span class="token function">Route</span><span class="token punctuation">(</span> FSlateApplication<span class="token operator">*</span> ThisApplication<span class="token punctuation">,</span> RoutingPolicyType RoutingPolicy<span class="token punctuation">,</span> EventType EventCopy<span class="token punctuation">,</span> 
    <span class="token keyword">const</span> FuncType<span class="token operator">&amp;</span> Lambda<span class="token punctuation">,</span> ESlateDebuggingInputEvent DebuggingInputEvent<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    ReplyType Reply <span class="token operator">=</span> <span class="token class-name">ReplyType</span><span class="token double-colon punctuation">::</span><span class="token function">Unhandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> FWidgetPath<span class="token operator">&amp;</span> RoutingPath <span class="token operator">=</span> RoutingPolicy<span class="token punctuation">.</span><span class="token function">GetRoutingPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> FWidgetPath<span class="token operator">*</span> WidgetsUnderCursor <span class="token operator">=</span> RoutingPolicy<span class="token punctuation">.</span><span class="token function">GetWidgetsUnderCursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    EventCopy<span class="token punctuation">.</span><span class="token function">SetEventPath</span><span class="token punctuation">(</span> RoutingPath <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> <span class="token operator">!</span>Reply<span class="token punctuation">.</span><span class="token function">IsEventHandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> RoutingPolicy<span class="token punctuation">.</span><span class="token function">ShouldKeepGoing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> RoutingPolicy<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> FWidgetAndPointer<span class="token operator">&amp;</span> ArrangedWidget <span class="token operator">=</span> RoutingPolicy<span class="token punctuation">.</span><span class="token function">GetWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">PLATFORM_COMPILER_HAS_IF_CONSTEXPR</span></span>
        <span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span><span class="token class-name">Translate</span><span class="token operator">&lt;</span>EventType<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">TranslationNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> EventType TranslatedEvent <span class="token operator">=</span> <span class="token class-name">Translate</span><span class="token operator">&lt;</span>EventType<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">PointerEvent</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">.</span>PointerPosition<span class="token punctuation">,</span> EventCopy<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//** line:378 **//</span>
            Reply <span class="token operator">=</span> <span class="token function">Lambda</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">,</span> TranslatedEvent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetHandler</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">.</span>Widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">ProcessReply</span><span class="token punctuation">(</span>ThisApplication<span class="token punctuation">,</span> RoutingPath<span class="token punctuation">,</span> Reply<span class="token punctuation">,</span> WidgetsUnderCursor<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TranslatedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">&#123;</span>
            Reply <span class="token operator">=</span> <span class="token function">Lambda</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">,</span> EventCopy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetHandler</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">.</span>Widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">ProcessReply</span><span class="token punctuation">(</span>ThisApplication<span class="token punctuation">,</span> RoutingPath<span class="token punctuation">,</span> Reply<span class="token punctuation">,</span> WidgetsUnderCursor<span class="token punctuation">,</span> <span class="token operator">&amp;</span>EventCopy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
        <span class="token keyword">const</span> EventType TranslatedEvent <span class="token operator">=</span> <span class="token class-name">Translate</span><span class="token operator">&lt;</span>EventType<span class="token operator">></span><span class="token double-colon punctuation">::</span><span class="token function">PointerEvent</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">.</span>PointerPosition<span class="token punctuation">,</span> EventCopy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Reply <span class="token operator">=</span> <span class="token function">Lambda</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">,</span> TranslatedEvent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetHandler</span><span class="token punctuation">(</span>ArrangedWidget<span class="token punctuation">.</span>Widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ProcessReply</span><span class="token punctuation">(</span>ThisApplication<span class="token punctuation">,</span> RoutingPath<span class="token punctuation">,</span> Reply<span class="token punctuation">,</span> WidgetsUnderCursor<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TranslatedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> Reply<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
* Engine\Source\Runtime\Slate\Private\Framework\Application\SlateApplication.cpp
*/</span>
FReply <span class="token class-name">FSlateApplication</span><span class="token double-colon punctuation">::</span><span class="token function">RoutePointerUpEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> FWidgetPath<span class="token operator">&amp;</span> WidgetsUnderPointer<span class="token punctuation">,</span> <span class="token keyword">const</span> FPointerEvent<span class="token operator">&amp;</span> PointerEvent<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>

    <span class="token comment">// Switch worlds widgets in the current path</span>
    FScopedSwitchWorldHack <span class="token function">SwitchWorld</span><span class="token punctuation">(</span> MouseCaptorPath <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//** line:4815 **//</span>
    Reply <span class="token operator">=</span> FEventRouter<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">Route</span><span class="token generic class-name"><span class="token operator">&lt;</span>FReply<span class="token operator">></span></span></span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">FEventRouter</span><span class="token double-colon punctuation">::</span><span class="token function">FToLeafmostPolicy</span><span class="token punctuation">(</span>MouseCaptorPath<span class="token punctuation">)</span><span class="token punctuation">,</span> PointerEvent<span class="token punctuation">,</span> 
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">]</span><span class="token punctuation">(</span> <span class="token keyword">const</span> FArrangedWidget<span class="token operator">&amp;</span> TargetWidget<span class="token punctuation">,</span> <span class="token keyword">const</span> FPointerEvent<span class="token operator">&amp;</span> Event <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            FReply TempReply <span class="token operator">=</span> <span class="token class-name">FReply</span><span class="token double-colon punctuation">::</span><span class="token function">Unhandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Event<span class="token punctuation">.</span><span class="token function">IsTouchEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                TempReply <span class="token operator">=</span> TargetWidget<span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">OnTouchEnded</span><span class="token punctuation">(</span>TargetWidget<span class="token punctuation">.</span>Geometry<span class="token punctuation">,</span> Event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Event<span class="token punctuation">.</span><span class="token function">IsTouchEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">!</span>TempReply<span class="token punctuation">.</span><span class="token function">IsEventHandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-></span>bTouchFallbackToMouse<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token comment">//** line:4829 **//</span>
                TempReply <span class="token operator">=</span> TargetWidget<span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">OnMouseButtonUp</span><span class="token punctuation">(</span> TargetWidget<span class="token punctuation">.</span>Geometry<span class="token punctuation">,</span> Event <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span> Event<span class="token punctuation">.</span><span class="token function">IsTouchEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">IsFakingTouchEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token comment">// Generate a Leave event when a touch ends as well, since a </span>
                <span class="token comment">// touch can enter a widget and then end inside it</span>
                TargetWidget<span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">OnMouseLeave</span><span class="token punctuation">(</span>Event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">return</span> TempReply<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> ESlateDebuggingInputEvent<span class="token double-colon punctuation">::</span>MouseButtonUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
* Engine\Source\Runtime\Slate\Private\Widgets\Input\SButton.cpp
*/</span>
FReply <span class="token class-name">SButton</span><span class="token double-colon punctuation">::</span><span class="token function">OnMouseButtonUp</span><span class="token punctuation">(</span> <span class="token keyword">const</span> FGeometry<span class="token operator">&amp;</span> MyGeometry<span class="token punctuation">,</span> <span class="token keyword">const</span> FPointerEvent<span class="token operator">&amp;</span> MouseEvent <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	FReply Reply <span class="token operator">=</span> <span class="token class-name">FReply</span><span class="token double-colon punctuation">::</span><span class="token function">Unhandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>

    <span class="token comment">//** line:304 **//</span>
    Reply <span class="token operator">=</span> <span class="token function">ExecuteOnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
* Engine\Source\Runtime\Slate\Private\Widgets\Input\SButton.cpp
*/</span>
FReply <span class="token class-name">SButton</span><span class="token double-colon punctuation">::</span><span class="token function">ExecuteOnClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>OnClicked<span class="token punctuation">.</span><span class="token function">IsBound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">//** line:385 **//</span>
        FReply Reply <span class="token operator">=</span> OnClicked<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> Reply<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">FReply</span><span class="token double-colon punctuation">::</span><span class="token function">Handled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/**
* Engine\Source\Runtime\UMG\Private\Components\Button.cpp
*/</span>
FReply <span class="token class-name">UButton</span><span class="token double-colon punctuation">::</span><span class="token function">SlateHandleClicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>

    <span class="token comment">//** line:203 **//</span>
    OnClicked<span class="token punctuation">.</span><span class="token function">Broadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">FReply</span><span class="token double-colon punctuation">::</span><span class="token function">Handled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="获取响应控件">获取响应控件</h2><p>UE4中，为了方便获取鼠标响应控件，会将屏幕区域划分成一个一个区域，然后按照区域，将控件划分到对应的区域中管理，一个控件可能会被划分到多个区域中。例如：1920 * 1080 分辨率会被划分成 15 * 9 个Cell。详细代码参见如下：<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/**
* Engine\Source\Runtime\SlateCore\Private\Input\HittestGrid.cpp
*/</span>
<span class="token comment">// 屏幕分区大小</span>
<span class="token keyword">const</span> FVector2D <span class="token function">CellSize</span><span class="token punctuation">(</span><span class="token number">128.0f</span><span class="token punctuation">,</span> <span class="token number">128.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 计算屏幕分区个数</span>
<span class="token keyword">bool</span> <span class="token class-name">FHittestGrid</span><span class="token double-colon punctuation">::</span><span class="token function">SetHittestArea</span><span class="token punctuation">(</span><span class="token keyword">const</span> FVector2D<span class="token operator">&amp;</span> HittestPositionInDesktop<span class="token punctuation">,</span> <span class="token keyword">const</span> FVector2D<span class="token operator">&amp;</span> HittestDimensions<span class="token punctuation">,</span>
    <span class="token keyword">const</span> FVector2D<span class="token operator">&amp;</span> HitestOffsetInWindow<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">bool</span> bWasCleared <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">// If the size of the hit test area changes we need to clear it out</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>GridSize <span class="token operator">!=</span> HittestDimensions<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        GridSize <span class="token operator">=</span> HittestDimensions<span class="token punctuation">;</span>
        NumCells <span class="token operator">=</span> <span class="token function">FIntPoint</span><span class="token punctuation">(</span><span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">CeilToInt</span><span class="token punctuation">(</span>GridSize<span class="token punctuation">.</span>X <span class="token operator">/</span> CellSize<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">CeilToInt</span><span class="token punctuation">(</span>GridSize<span class="token punctuation">.</span>Y <span class="token operator">/</span> CellSize<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">const</span> int32 NewTotalCells <span class="token operator">=</span> NumCells<span class="token punctuation">.</span>X <span class="token operator">*</span> NumCells<span class="token punctuation">.</span>Y<span class="token punctuation">;</span>
        <span class="token function">ClearInternal</span><span class="token punctuation">(</span>NewTotalCells<span class="token punctuation">)</span><span class="token punctuation">;</span>

        bWasCleared <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    GridOrigin <span class="token operator">=</span> HittestPositionInDesktop<span class="token punctuation">;</span>
    GridWindowOrigin <span class="token operator">=</span> HitestOffsetInWindow<span class="token punctuation">;</span>

    <span class="token keyword">return</span> bWasCleared<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 通过屏幕坐标获取对应分割区Cell坐标</span>
FIntPoint <span class="token class-name">FHittestGrid</span><span class="token double-colon punctuation">::</span><span class="token function">GetCellCoordinate</span><span class="token punctuation">(</span>FVector2D Position<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">FIntPoint</span><span class="token punctuation">(</span>
        <span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">Min</span><span class="token punctuation">(</span><span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">FloorToInt</span><span class="token punctuation">(</span>Position<span class="token punctuation">.</span>X <span class="token operator">/</span> CellSize<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> NumCells<span class="token punctuation">.</span>X <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">Min</span><span class="token punctuation">(</span><span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">FloorToInt</span><span class="token punctuation">(</span>Position<span class="token punctuation">.</span>Y <span class="token operator">/</span> CellSize<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> NumCells<span class="token punctuation">.</span>Y <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>HittestGrid 每帧都会刷新，刷新堆栈如下： <img data-src="/images/ue4_event/update_hittest_area.png" width="100%" height="100%" align="middle"></p><p>每帧从SWindow根节点开始绘制，调用SetHittestArea函数，刷新HittestGrid：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">int32 <span class="token class-name">SWindow</span><span class="token double-colon punctuation">::</span><span class="token function">PaintWindow</span><span class="token punctuation">(</span> <span class="token keyword">double</span> CurrentTime<span class="token punctuation">,</span> <span class="token keyword">float</span> DeltaTime<span class="token punctuation">,</span> FSlateWindowElementList<span class="token operator">&amp;</span> OutDrawElements<span class="token punctuation">,</span> 
    <span class="token keyword">const</span> FWidgetStyle<span class="token operator">&amp;</span> InWidgetStyle<span class="token punctuation">,</span> <span class="token keyword">bool</span> bParentEnabled <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// 更新HittestArea屏幕大小</span>
    <span class="token keyword">const</span> <span class="token keyword">bool</span> HittestCleared <span class="token operator">=</span> HittestGrid<span class="token operator">-></span><span class="token function">SetHittestArea</span><span class="token punctuation">(</span><span class="token function">GetPositionInScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">GetViewportSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FPaintArgs <span class="token function">PaintArgs</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token function">GetHittestGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">GetPositionInScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CurrentTime<span class="token punctuation">,</span> DeltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    FSlateInvalidationContext <span class="token function">Context</span><span class="token punctuation">(</span>OutDrawElements<span class="token punctuation">,</span> InWidgetStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Context<span class="token punctuation">.</span>bParentEnabled <span class="token operator">=</span> bParentEnabled<span class="token punctuation">;</span>
    Context<span class="token punctuation">.</span>PaintArgs <span class="token operator">=</span> <span class="token operator">&amp;</span>PaintArgs<span class="token punctuation">;</span>

    <span class="token comment">// 开始绘制窗口界面</span>
    FSlateInvalidationResult Result <span class="token operator">=</span> <span class="token function">PaintInvalidationRoot</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根节点开始Paint后，会以深度优先方式遍历所有子节点，并调用子节点的Paint函数<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/**
* Engine\Source\Runtime\SlateCore\Private\Widgets\SWidget.cpp
*/</span>
int32 <span class="token class-name">SWidget</span><span class="token double-colon punctuation">::</span><span class="token function">Paint</span><span class="token punctuation">(</span><span class="token keyword">const</span> FPaintArgs<span class="token operator">&amp;</span> Args<span class="token punctuation">,</span> <span class="token keyword">const</span> FGeometry<span class="token operator">&amp;</span> AllottedGeometry<span class="token punctuation">,</span> 
    <span class="token keyword">const</span> FSlateRect<span class="token operator">&amp;</span> MyCullingRect<span class="token punctuation">,</span> FSlateWindowElementList<span class="token operator">&amp;</span> OutDrawElements<span class="token punctuation">,</span> 
    int32 LayerId<span class="token punctuation">,</span> <span class="token keyword">const</span> FWidgetStyle<span class="token operator">&amp;</span> InWidgetStyle<span class="token punctuation">,</span> <span class="token keyword">bool</span> bParentEnabled<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    OutDrawElements<span class="token punctuation">.</span><span class="token function">PushPaintingWidget</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">,</span> LayerId<span class="token punctuation">,</span> PersistentState<span class="token punctuation">.</span>CachedElementHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>bOutgoingHittestability<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">//** line:1344 **//</span>
        Args<span class="token punctuation">.</span><span class="token function">GetHittestGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddWidget</span><span class="token punctuation">(</span>MutableThis<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> LayerId<span class="token punctuation">,</span> FastPathProxyHandle<span class="token punctuation">.</span><span class="token function">GetIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// ...</span>
    <span class="token comment">// Paint the geometry of this widget.</span>
    int32 NewLayerId <span class="token operator">=</span> <span class="token function">OnPaint</span><span class="token punctuation">(</span>UpdatedArgs<span class="token punctuation">,</span> AllottedGeometry<span class="token punctuation">,</span> CullingBounds<span class="token punctuation">,</span> OutDrawElements<span class="token punctuation">,</span> LayerId<span class="token punctuation">,</span> 
        ContentWidgetStyle<span class="token punctuation">,</span> bParentEnabled<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>然后再调用FHittestGrid::AddWidget函数，对每个Widget进行区域划分，将Widget加入对应的Cell中。<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token class-name">FHittestGrid</span><span class="token double-colon punctuation">::</span><span class="token function">AddWidget</span><span class="token punctuation">(</span><span class="token keyword">const</span> TSharedRef<span class="token operator">&lt;</span>SWidget<span class="token operator">></span><span class="token operator">&amp;</span> InWidget<span class="token punctuation">,</span> int32 InBatchPriorityGroup<span class="token punctuation">,</span> 
    int32 InLayerId<span class="token punctuation">,</span> int32 InSecondarySort<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// Widget不可见，直接返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>InWidget<span class="token operator">-></span><span class="token function">GetVisibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsHitTestVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    FGeometry GridSpaceGeometry <span class="token operator">=</span> InWidget<span class="token operator">-></span><span class="token function">GetPaintSpaceGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    GridSpaceGeometry<span class="token punctuation">.</span><span class="token function">AppendTransform</span><span class="token punctuation">(</span><span class="token function">FSlateLayoutTransform</span><span class="token punctuation">(</span><span class="token operator">-</span>GridWindowOrigin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> FSlateRect BoundingRect <span class="token operator">=</span> GridSpaceGeometry<span class="token punctuation">.</span><span class="token function">GetRenderBoundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取Widget最左上角跟最右下角的Cell Index</span>
    <span class="token comment">// 后面循环将Widget加入到对应的Cell区域</span>
    <span class="token keyword">const</span> FIntPoint UpperLeftCell <span class="token operator">=</span> <span class="token function">GetCellCoordinate</span><span class="token punctuation">(</span>BoundingRect<span class="token punctuation">.</span><span class="token function">GetTopLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> FIntPoint LowerRightCell <span class="token operator">=</span> <span class="token function">GetCellCoordinate</span><span class="token punctuation">(</span>BoundingRect<span class="token punctuation">.</span><span class="token function">GetBottomRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>bAddWidget<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        int32<span class="token operator">&amp;</span> WidgetIndex <span class="token operator">=</span> WidgetMap<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span>InWidget<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int32 XIndex <span class="token operator">=</span> UpperLeftCell<span class="token punctuation">.</span>X<span class="token punctuation">;</span> XIndex <span class="token operator">&lt;=</span> LowerRightCell<span class="token punctuation">.</span>X<span class="token punctuation">;</span> <span class="token operator">++</span>XIndex<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>int32 YIndex <span class="token operator">=</span> UpperLeftCell<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> YIndex <span class="token operator">&lt;=</span> LowerRightCell<span class="token punctuation">.</span>Y<span class="token punctuation">;</span> <span class="token operator">++</span>YIndex<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsValidCellCoord</span><span class="token punctuation">(</span>XIndex<span class="token punctuation">,</span> YIndex<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token function">CellAt</span><span class="token punctuation">(</span>XIndex<span class="token punctuation">,</span> YIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddIndex</span><span class="token punctuation">(</span>WidgetIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p><h2 id="todo">TODO:</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">FWidgetPath <span class="token class-name">FSlateApplication</span><span class="token double-colon punctuation">::</span><span class="token function">LocateWidgetInWindow</span><span class="token punctuation">(</span>FVector2D ScreenspaceMouseCoordinate<span class="token punctuation">,</span> <span class="token keyword">const</span> TSharedRef<span class="token operator">&lt;</span>SWindow<span class="token operator">></span><span class="token operator">&amp;</span> Window<span class="token punctuation">,</span> <span class="token keyword">bool</span> bIgnoreEnabledStatus<span class="token punctuation">,</span> int32 UserIndex<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token keyword">bool</span> bAcceptsInput <span class="token operator">=</span> Window<span class="token operator">-></span><span class="token function">IsVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>Window<span class="token operator">-></span><span class="token function">AcceptsInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">IsWindowHousingInteractiveTooltip</span><span class="token punctuation">(</span>Window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bAcceptsInput <span class="token operator">&amp;&amp;</span> Window<span class="token operator">-></span><span class="token function">IsScreenspaceMouseWithin</span><span class="token punctuation">(</span>ScreenspaceMouseCoordinate<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        TArray<span class="token operator">&lt;</span>FWidgetAndPointer<span class="token operator">></span> WidgetsAndCursors <span class="token operator">=</span> Window<span class="token operator">-></span><span class="token function">GetHittestGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetBubblePath</span><span class="token punctuation">(</span>ScreenspaceMouseCoordinate<span class="token punctuation">,</span> <span class="token function">GetCursorRadius</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bIgnoreEnabledStatus<span class="token punctuation">,</span> UserIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">FWidgetPath</span><span class="token punctuation">(</span><span class="token function">MoveTemp</span><span class="token punctuation">(</span>WidgetsAndCursors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">FWidgetPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>



TArray<span class="token operator">&lt;</span>FWidgetAndPointer<span class="token operator">></span> <span class="token class-name">FHittestGrid</span><span class="token double-colon punctuation">::</span><span class="token function">GetBubblePath</span><span class="token punctuation">(</span>FVector2D DesktopSpaceCoordinate<span class="token punctuation">,</span> <span class="token keyword">float</span> CursorRadius<span class="token punctuation">,</span> <span class="token keyword">bool</span> bIgnoreEnabledStatus<span class="token punctuation">,</span> int32 UserIndex<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">checkSlow</span><span class="token punctuation">(</span><span class="token function">IsInGameThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> FVector2D CursorPositionInGrid <span class="token operator">=</span> DesktopSpaceCoordinate <span class="token operator">-</span> GridOrigin<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>WidgetArray<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> Cells<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        FGridTestingParams TestingParams<span class="token punctuation">;</span>
        TestingParams<span class="token punctuation">.</span>CursorPositionInGrid <span class="token operator">=</span> CursorPositionInGrid<span class="token punctuation">;</span>
        TestingParams<span class="token punctuation">.</span>CellCoord <span class="token operator">=</span> <span class="token function">GetCellCoordinate</span><span class="token punctuation">(</span>CursorPositionInGrid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        TestingParams<span class="token punctuation">.</span>Radius <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
        TestingParams<span class="token punctuation">.</span>bTestWidgetIsInteractive <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// First add the exact point test results</span>
        <span class="token keyword">const</span> FIndexAndDistance BestHit <span class="token operator">=</span> <span class="token function">GetHitIndexFromCellIndex</span><span class="token punctuation">(</span>TestingParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>BestHit<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> FWidgetData<span class="token operator">&amp;</span> BestHitWidgetData <span class="token operator">=</span> BestHit<span class="token punctuation">.</span><span class="token function">GetWidgetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> TSharedPtr<span class="token operator">&lt;</span>SWidget<span class="token operator">></span> FirstHitWidget <span class="token operator">=</span> BestHitWidgetData<span class="token punctuation">.</span><span class="token function">GetWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Make Sure we landed on a valid widget</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>FirstHitWidget<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">IsCompatibleUserIndex</span><span class="token punctuation">(</span>UserIndex<span class="token punctuation">,</span> BestHitWidgetData<span class="token punctuation">.</span>UserIndex<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                TArray<span class="token operator">&lt;</span>FWidgetAndPointer<span class="token operator">></span> Path<span class="token punctuation">;</span>

                TSharedPtr<span class="token operator">&lt;</span>SWidget<span class="token operator">></span> CurWidget <span class="token operator">=</span> FirstHitWidget<span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>CurWidget<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    FGeometry DesktopSpaceGeometry <span class="token operator">=</span> CurWidget<span class="token operator">-></span><span class="token function">GetPaintSpaceGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    DesktopSpaceGeometry<span class="token punctuation">.</span><span class="token function">AppendTransform</span><span class="token punctuation">(</span><span class="token function">FSlateLayoutTransform</span><span class="token punctuation">(</span>GridOrigin <span class="token operator">-</span> GridWindowOrigin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    Path<span class="token punctuation">.</span><span class="token function">Emplace</span><span class="token punctuation">(</span><span class="token function">FArrangedWidget</span><span class="token punctuation">(</span>CurWidget<span class="token punctuation">.</span><span class="token function">ToSharedRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DesktopSpaceGeometry<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">TSharedPtr</span><span class="token generic class-name"><span class="token operator">&lt;</span>FVirtualPointerPosition<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    CurWidget <span class="token operator">=</span> CurWidget<span class="token operator">-></span><span class="token function">Advanced_GetPaintParentWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Path<span class="token punctuation">.</span><span class="token function">Last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">Advanced_IsWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">TArray</span><span class="token generic class-name"><span class="token operator">&lt;</span>FWidgetAndPointer<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token class-name">Algo</span><span class="token double-colon punctuation">::</span><span class="token function">Reverse</span><span class="token punctuation">(</span>Path<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">bool</span> bRemovedDisabledWidgets <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bIgnoreEnabledStatus<span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token comment">// @todo It might be more correct to remove all disabled widgets and non-hit testable widgets.  It doesn't make sense to have a hit test invisible widget as a leaf in the path</span>
                    <span class="token comment">// and that can happen if we remove a disabled widget. Furthermore if we did this we could then append custom paths in all cases since the leaf most widget would be hit testable</span>
                    <span class="token comment">// For backwards compatibility changing this could be risky</span>
                    <span class="token keyword">const</span> int32 DisabledWidgetIndex <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">IndexOfByPredicate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> FArrangedWidget<span class="token operator">&amp;</span> SomeWidget<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token operator">!</span>SomeWidget<span class="token punctuation">.</span>Widget<span class="token operator">-></span><span class="token function">IsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>DisabledWidgetIndex <span class="token operator">!=</span> INDEX_NONE<span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        bRemovedDisabledWidgets <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                        Path<span class="token punctuation">.</span><span class="token function">RemoveAt</span><span class="token punctuation">(</span>DisabledWidgetIndex<span class="token punctuation">,</span> Path<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> DisabledWidgetIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bRemovedDisabledWidgets <span class="token operator">&amp;&amp;</span> Path<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>BestHitWidgetData<span class="token punctuation">.</span>CustomPath<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token keyword">const</span> TArray<span class="token operator">&lt;</span>FWidgetAndPointer<span class="token operator">></span> BubblePathExtension <span class="token operator">=</span> BestHitWidgetData<span class="token punctuation">.</span>CustomPath<span class="token punctuation">.</span><span class="token function">Pin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">GetBubblePathAndVirtualCursors</span><span class="token punctuation">(</span>FirstHitWidget<span class="token operator">-></span><span class="token function">GetTickSpaceGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DesktopSpaceCoordinate<span class="token punctuation">,</span> bIgnoreEnabledStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        Path<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>BubblePathExtension<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
    
                <span class="token keyword">return</span> Path<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">TArray</span><span class="token generic class-name"><span class="token operator">&lt;</span>FWidgetAndPointer<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>



FHittestGrid<span class="token double-colon punctuation">::</span>FIndexAndDistance <span class="token class-name">FHittestGrid</span><span class="token double-colon punctuation">::</span><span class="token function">GetHitIndexFromCellIndex</span><span class="token punctuation">(</span><span class="token keyword">const</span> FGridTestingParams<span class="token operator">&amp;</span> Params<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">//check if the cell coord </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsValidCellCoord</span><span class="token punctuation">(</span>Params<span class="token punctuation">.</span>CellCoord<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">// Get the cell and sort it </span>
        FCollapsedWidgetsArray WidgetIndexes<span class="token punctuation">;</span>
        <span class="token function">GetCollapsedWidgets</span><span class="token punctuation">(</span>WidgetIndexes<span class="token punctuation">,</span> Params<span class="token punctuation">.</span>CellCoord<span class="token punctuation">.</span>X<span class="token punctuation">,</span> Params<span class="token punctuation">.</span>CellCoord<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Consider front-most widgets first for hittesting.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int32 i <span class="token operator">=</span> WidgetIndexes<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token function">check</span><span class="token punctuation">(</span>WidgetIndexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> FWidgetData<span class="token operator">&amp;</span> TestCandidate <span class="token operator">=</span> WidgetIndexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetWidgetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> TSharedPtr<span class="token operator">&lt;</span>SWidget<span class="token operator">></span> TestWidget <span class="token operator">=</span> TestCandidate<span class="token punctuation">.</span><span class="token function">GetWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// When performing a point hittest, accept all hittestable widgets.</span>
            <span class="token comment">// When performing a hittest with a radius, only grab interactive widgets.</span>
            <span class="token keyword">const</span> <span class="token keyword">bool</span> bIsValidWidget <span class="token operator">=</span> TestWidget<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>Params<span class="token punctuation">.</span>bTestWidgetIsInteractive <span class="token operator">||</span> TestWidget<span class="token operator">-></span><span class="token function">IsInteractable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bIsValidWidget<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">const</span> FVector2D WindowSpaceCoordinate <span class="token operator">=</span> Params<span class="token punctuation">.</span>CursorPositionInGrid <span class="token operator">+</span> GridWindowOrigin<span class="token punctuation">;</span>

                <span class="token keyword">const</span> FGeometry<span class="token operator">&amp;</span> TestGeometry <span class="token operator">=</span> TestWidget<span class="token operator">-></span><span class="token function">GetPaintSpaceGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">bool</span> bPointInsideClipMasks <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>WidgetIndexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetCullingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    bPointInsideClipMasks <span class="token operator">=</span> WidgetIndexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetCullingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ContainsPoint</span><span class="token punctuation">(</span>WindowSpaceCoordinate<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>bPointInsideClipMasks<span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token keyword">const</span> TOptional<span class="token operator">&lt;</span>FSlateClippingState<span class="token operator">></span><span class="token operator">&amp;</span> WidgetClippingState <span class="token operator">=</span> TestWidget<span class="token operator">-></span><span class="token function">GetCurrentClippingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>WidgetClippingState<span class="token punctuation">.</span><span class="token function">IsSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token comment">// TODO: Solve non-zero radius cursors?</span>
                        bPointInsideClipMasks <span class="token operator">=</span> WidgetClippingState<span class="token operator">-></span><span class="token function">IsPointInside</span><span class="token punctuation">(</span>WindowSpaceCoordinate<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>bPointInsideClipMasks<span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token comment">// Compute the render space clipping rect (FGeometry exposes a layout space clipping rect).</span>
                    <span class="token keyword">const</span> FSlateRotatedRect WindowOrientedClipRect <span class="token operator">=</span> <span class="token function">TransformRect</span><span class="token punctuation">(</span>
                        <span class="token function">Concatenate</span><span class="token punctuation">(</span>
                            <span class="token function">Inverse</span><span class="token punctuation">(</span>TestGeometry<span class="token punctuation">.</span><span class="token function">GetAccumulatedLayoutTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            TestGeometry<span class="token punctuation">.</span><span class="token function">GetAccumulatedRenderTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">FSlateRotatedRect</span><span class="token punctuation">(</span>TestGeometry<span class="token punctuation">.</span><span class="token function">GetLayoutBoundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsOverlappingSlateRotatedRect</span><span class="token punctuation">(</span>WindowSpaceCoordinate<span class="token punctuation">,</span> Params<span class="token punctuation">.</span>Radius<span class="token punctuation">,</span> WindowOrientedClipRect<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token comment">// For non-0 radii also record the distance to cursor's center so that we can pick the closest hit from the results.</span>
                        <span class="token keyword">const</span> <span class="token keyword">bool</span> bNeedsDistanceSearch <span class="token operator">=</span> Params<span class="token punctuation">.</span>Radius <span class="token operator">></span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
                        <span class="token keyword">const</span> <span class="token keyword">float</span> DistSq <span class="token operator">=</span> <span class="token punctuation">(</span>bNeedsDistanceSearch<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">DistanceSqToSlateRotatedRect</span><span class="token punctuation">(</span>WindowSpaceCoordinate<span class="token punctuation">,</span> WindowOrientedClipRect<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token function">FIndexAndDistance</span><span class="token punctuation">(</span>WidgetIndexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> DistSq<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token function">FIndexAndDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="响应事件">响应事件</h2><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css"></div><footer class="post-footer"><div class="license"><div class="license-title">UE4 SlateUI事件机制</div><div class="license-link"><a href="https://www.xianlongok.site/post/360e070e/">https://www.xianlongok.site/post/360e070e/</a></div><div class="license-meta"><div class="license-meta-item"><div class="license-meta-title">本文作者</div><div class="license-meta-text">小贤</div></div><div class="license-meta-item"><div class="license-meta-title">发布于</div><div class="license-meta-text">2021-04-29</div></div><div class="license-meta-item"><div class="license-meta-title">更新于</div><div class="license-meta-text">2022-05-14</div></div><div class="license-meta-item"><div class="license-meta-title">许可协议</div><div class="license-meta-text"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank">CC BY-NC-SA 4.0</a></div></div></div><div class="license-statement">转载或引用本文时，请遵守上述许可协议，注明出处、不得用于商业用途！</div></div><div class="post-tags"><a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C++</a> <a href="/tags/UE4/" rel="tag"><i class="fa fa-tag"></i> UE4</a> <a href="/tags/UMG/" rel="tag"><i class="fa fa-tag"></i> UMG</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/8d8c27a4/" rel="prev" title="UMG源码笔记"><i class="fa fa-chevron-left"></i> UMG源码笔记</a></div><div class="post-nav-item"><a href="/post/637d361d/" rel="next" title="UnrealEnginPython踩坑记录">UnrealEnginPython踩坑记录 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2021 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fas fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">小贤</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">205k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">3:07</span></span></div><div class="powered"><a href="https://dlzhang.com" rel="noopener" target="_blank">小贤</a>使用 <a href="https://hexo.io" rel="noopener" target="_blank">Hexo</a> <a href="https://theme-next.js.org" rel="noopener" target="_blank">NexT</a> 设计搭建</div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script src="/js/third-party/fancybox.js"></script><script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"dkLUcqHORjRdwQiwRPJMs00N-gzGzoHsz","app_key":"EhWnaex3YyY7bQysJ2SFnukE","server_url":null,"security":false}</script><script src="/js/third-party/statistics/lean-analytics.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script><script src="/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline-comment-nfec4vcyk-qq317423892.vercel.app/","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"libUrl":"https://unpkg.com/@waline/client@v2/dist/waline.js","login":"disable","meta":["nick","mail","link"],"requiredMeta":["nick","mail"],"pageSize":5,"dark":"auto","emoji":false,"locale":{"placeholder":"请正确填写邮箱方便查收回复，评论通过审核才会显示。","admin":"站长","nick":"名称*","mail":"邮箱*","link":"网址"},"el":"#waline","comment":true,"path":"/post/360e070e/"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"><script>document.addEventListener("page:loaded",()=>{NexT.utils.loadComments(CONFIG.waline.el).then(()=>NexT.utils.getScript(CONFIG.waline.libUrl,{condition:window.Waline})).then(()=>Waline.init(Object.assign({},CONFIG.waline,{el:document.querySelector(CONFIG.waline.el)})))})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false}});</script></body></html>